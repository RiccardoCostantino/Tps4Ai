<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reader JSON/XML</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #output {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>Carica un file JSON o XML</h1>
    
    <input type="file" id="fileInput" />
    
    <div id="output"></div>

    <script>
        document.getElementById('fileInput').addEventListener('change', handleFileUpload);

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const fileContent = e.target.result;
                const fileType = file.name.split('.').pop().toLowerCase();
                
                if (fileType === 'json') {
                    processJSON(fileContent);
                } else if (fileType === 'xml') {
                    processXML(fileContent);
                } else {
                    alert('File non supportato! Carica un file JSON o XML.');
                }
            };
            
            reader.readAsText(file);
        }

        function processJSON(content) {
            try {
                const jsonData = JSON.parse(content);
                displayData(jsonData);
            } catch (e) {
                alert('Errore nel parsing del file JSON');
            }
        }

        function processXML(content) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(content, "application/xml");
            const errorNode = xmlDoc.querySelector('parsererror');
            if (errorNode) {
                alert('Errore nel parsing del file XML');
                return;
            }
            displayData(xmlToJson(xmlDoc));
        }

        function displayData(data) {
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = '<h3>Output Dati:</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
        }

        function xmlToJson(xml) {
            const obj = {};
            if (xml.nodeType === 1) {
                if (xml.attributes.length > 0) {
                    obj["@attributes"] = {};
                    for (let i = 0; i < xml.attributes.length; i++) {
                        const attribute = xml.attributes.item(i);
                        obj["@attributes"][attribute.nodeName] = attribute.nodeValue;
                    }
                }
            }
            if (xml.nodeType === 3) {
                obj.text = xml.nodeValue;
            }
            if (xml.hasChildNodes()) {
                for (let i = 0; i < xml.childNodes.length; i++) {
                    const item = xml.childNodes.item(i);
                    const nodeName = item.nodeName;
                    if (typeof(obj[nodeName]) === "undefined") {
                        obj[nodeName] = xmlToJson(item);
                    } else {
                        if (typeof(obj[nodeName].push) === "undefined") {
                            const old = obj[nodeName];
                            obj[nodeName] = [];
                            obj[nodeName].push(old);
                        }
                        obj[nodeName].push(xmlToJson(item));
                    }
                }
            }
            return obj;
        }
    </script>
</body>
</html>
